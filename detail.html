<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chi ti·∫øt s·∫£n ph·∫©m | TNT Coffee</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/detail.css">
</head>

<body>
  <!-- HEADER -->
  <header class="header">
    <div class="logo">TNT COFFEE</div>
    <nav class="nav">
      <a href="index.html">Trang ch·ªß</a>
      <a href="products.html">S·∫£n ph·∫©m</a>
      <a href="cart.html">Gi·ªè h√†ng</a>
      <a href="account.html">T√†i kho·∫£n</a>
      <a href="contact.html">Li√™n h·ªá</a>
    </nav>
  </header>

  <!-- CHI TI·∫æT S·∫¢N PH·∫®M -->
  <section class="product-detail">
    <div class="detail-container">
      <div class="detail-left">
        <img id="product-img" src="" alt="S·∫£n ph·∫©m TNT Coffee">
      </div>

      <div class="detail-right">
        <h1 id="product-name"></h1>
        <p id="product-category" class="category"></p>
        <p id="product-price" class="price"></p>

        <p id="product-desc" class="desc">
          M·ªôt trong nh·ªØng m√≥n ƒë∆∞·ª£c y√™u th√≠ch nh·∫•t t·∫°i TNT Coffee, pha ch·∫ø t∆∞∆°i m·ªõi m·ªói ng√†y.
        </p>

        <div class="options">
          <h4>K√≠ch c·ª°</h4>
          <button class="option-btn active" data-size="M">M</button>
          <button class="option-btn" data-size="L">L</button>
        </div>

        <div class="options sweetness-options">
          <h4>ƒê·ªô ng·ªçt</h4>
          <button class="option-btn">√çt</button>
          <button class="option-btn active">B√¨nh th∆∞·ªùng</button>
          <button class="option-btn">Nhi·ªÅu</button>
        </div>

        <div class="options ice-options">
          <h4>ƒê√°</h4>
          <button class="option-btn">√çt</button>
          <button class="option-btn active">B√¨nh th∆∞·ªùng</button>
          <button class="option-btn">Nhi·ªÅu</button>
        </div>

        <div class="quantity">
          <button id="minus">‚àí</button>
          <input type="number" id="qty" value="1" min="1">
          <button id="plus">+</button>
        </div>

        <button id="add-cart" class="add-cart">üõí Th√™m v√†o gi·ªè h√†ng</button>
        <button class="back-btn" onclick="window.location.href='products.html'">‚Üê Quay l·∫°i danh s√°ch</button>
      </div>
    </div>
  </section>

  <!-- TOAST TH√îNG B√ÅO -->
  <div id="toast" class="toast"></div>

  <!-- FOOTER -->
  <div id="footer-placeholder"></div>

  <!-- SCRIPT -->
  <script src="assets/js/cart.js"></script>

  <script>
  // Load footer
  fetch("footer.html")
    .then(res => res.text())
    .then(data => document.getElementById("footer-placeholder").innerHTML = data);

  // L·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m
  const products = JSON.parse(localStorage.getItem("productsData")) || [];
  const productId = localStorage.getItem("selectedProduct");
  const product = products.find(p => p.id == productId);

  const img = document.getElementById("product-img");
  const name = document.getElementById("product-name");
  const price = document.getElementById("product-price");
  const category = document.getElementById("product-category");

  let currentPrice = 0;
  let priceM = 0;
  let priceL = 0;

  const sizeSection = document.querySelector(".options:nth-of-type(1)");

  if (product) {
    img.src = product.img;
    name.textContent = product.name;
    category.textContent =
      "Danh m·ª•c: " +
      (product.category === "coffee" ? "C√† ph√™" :
       product.category === "tea" ? "Tr√† tr√°i c√¢y" :
       product.category === "milktea" ? "Tr√† s·ªØa" :
       product.category === "matcha" ? "Matcha & Cacao" :
       product.category === "yogurt" ? "S·ªØa chua" :
       product.category === "smoothie" ? "Sinh t·ªë" :
       product.category === "soda" ? "Soda" : "Topping");

    priceM = product.priceM;
    priceL = product.priceL;
    currentPrice = priceM;
    price.textContent = currentPrice.toLocaleString() + "ƒë";

    if (priceM === priceL) sizeSection.style.display = "none";
  }

  // Ch·ªçn size
  const sizeBtns = document.querySelectorAll(".options:nth-of-type(1) .option-btn");
  sizeBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      sizeBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentPrice = btn.dataset.size === "M" ? priceM : priceL;
      price.textContent = currentPrice.toLocaleString() + "ƒë";
    });
  });

  // S·ªë l∆∞·ª£ng
  const qtyInput = document.getElementById("qty");
  document.getElementById("plus").onclick = () => qtyInput.value++;
  document.getElementById("minus").onclick = () => {
    if (qtyInput.value > 1) qtyInput.value--;
  };

  // Ch·ªçn ƒë·ªô ng·ªçt v√† ƒë√°
  function setupOptionGroup(selector) {
    const buttons = document.querySelectorAll(selector + " .option-btn");
    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });
  }
  setupOptionGroup(".sweetness-options");
  setupOptionGroup(".ice-options");

  // Th√™m v√†o gi·ªè
  document.getElementById("add-cart").addEventListener("click", () => {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const selectedSizeBtn = document.querySelector(".options:nth-of-type(1) .option-btn.active");
    const selectedSize = selectedSizeBtn ? selectedSizeBtn.dataset.size : "M·∫∑c ƒë·ªãnh";

    const item = {
      id: product.id,
      name: selectedSize === "M·∫∑c ƒë·ªãnh" ? product.name : `${product.name} (${selectedSize})`,
      price: currentPrice,
      qty: Number(qtyInput.value),
    };

    cart.push(item);
    localStorage.setItem("cart", JSON.stringify(cart));
    showToast("‚úîÔ∏è ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!", "success");
  });

  // Toast + √Çm thanh
  function showToast(message, type = "success") {
    let toast = document.getElementById("toast");
    if (!toast) {
      toast = document.createElement("div");
      toast.id = "toast";
      document.body.appendChild(toast);
    }
    toast.className = "toast";
    toast.textContent = message;
    toast.classList.add(type, "show");

    const audio = new Audio("assets/sounds/success.mp3");
    audio.volume = 0.4;
    audio.play().catch(()=>{});

    setTimeout(() => {
      toast.classList.remove("show");
      toast.style.animation = "fadeOut 0.4s forwards";
    }, 2500);
  }
  </script>
</body>
</html>
